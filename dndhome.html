<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>D&D Horizontal Timeline</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      background-color: #1e1e2f;
      color: #fff;
      font-family: Arial, sans-serif;
    }

    #timeline-container {
      width: 100vw;
      height: 100vh;
      overflow: hidden;
      position: relative;
      cursor: grab;
    }

    #timeline {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(1);
      transform-origin: center;
      display: flex;
      align-items: center;
      height: 4px;
      background-color: #888;
    }

    .event-marker {
      position: absolute;
      background: #4caf50;
      width: 10px;
      height: 10px;
      border-radius: 50%;
      transform: translate(-50%, -50%);
    }

    .event-marker:hover::after {
      content: attr(data-title) " - " attr(data-description);
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: #333;
      color: #fff;
      padding: 6px 10px;
      font-size: 14px;
      border-radius: 6px;
      white-space: nowrap;
    }

    .year-marker {
      position: absolute;
      top: -10px;
      width: 1px;
      height: 20px;
      background: #ccc;
    }

    .year-label {
      position: absolute;
      top: 15px;
      font-size: 12px;
      color: #aaa;
      white-space: nowrap;
      transform: translateX(-50%);
    }
  </style>
</head>
<body>

<div id="timeline-container">
  <div id="timeline"></div>
</div>

<script>
  const timeline = document.getElementById('timeline');
  const container = document.getElementById('timeline-container');

  // Settings
  const scaleFactor = 100; // pixels per 100 years
  const markerSpacing = 100; // every 100 years

  // Panning and zooming variables
  let isDragging = false;
  let lastMouse = { x: 0, y: 0 };
  let offsetX = 0;
  let offsetY = 0;
  let scale = 1;

  // Event loading
  fetch('events.txt')
    .then(res => res.text())
    .then(text => {
      const lines = text.trim().split('\n');
      const events = lines.map(line => {
        const [yearStr, title, desc] = line.split('|');
        return { year: parseInt(yearStr), title, desc };
      });

      renderTimeline(events);
    });

  function renderTimeline(events) {
    const years = events.map(e => e.year);
    const minYear = Math.floor(Math.min(...years) / 100) * 100 - 200;
    const maxYear = Math.ceil(Math.max(...years) / 100) * 100 + 200;

    const timelineWidth = ((maxYear - minYear) / 100) * scaleFactor;

    timeline.style.width = `${timelineWidth}px`;

    // Year markers
    for (let year = minYear; year <= maxYear; year += markerSpacing) {
      const x = ((year - minYear) / 100) * scaleFactor;

      const yearLine = document.createElement('div');
      yearLine.className = 'year-marker';
      yearLine.style.left = `${x}px`;
      timeline.appendChild(yearLine);

      const yearLabel = document.createElement('div');
      yearLabel.className = 'year-label';
      yearLabel.style.left = `${x}px`;
      yearLabel.textContent = `${year} DR`;
      timeline.appendChild(yearLabel);
    }

    // Event markers
    for (const event of events) {
      const x = ((event.year - minYear) / 100) * scaleFactor;
      const marker = document.createElement('div');
      marker.className = 'event-marker';
      marker.style.left = `${x}px`;
      marker.dataset.title = event.title;
      marker.dataset.description = event.desc;
      timeline.appendChild(marker);
    }
  }

  // Drag (pan) functionality
  container.addEventListener('mousedown', e => {
    isDragging = true;
    lastMouse.x = e.clientX;
    lastMouse.y = e.clientY;
    container.style.cursor = 'grabbing';
  });

  window.addEventListener('mouseup', () => {
    isDragging = false;
    container.style.cursor = 'grab';
  });

  window.addEventListener('mousemove', e => {
    if (!isDragging) return;

    const dx = e.clientX - lastMouse.x;
    const dy = e.clientY - lastMouse.y;
    lastMouse.x = e.clientX;
    lastMouse.y = e.clientY;

    offsetX += dx;
    offsetY += dy;

    updateTransform();
  });

  // Zoom with scroll (no Ctrl needed)
  container.addEventListener('wheel', e => {
    e.preventDefault();
    const zoomSpeed = 0.001;
    const delta = e.deltaY;
    scale -= delta * zoomSpeed;
    scale = Math.max(0.2, Math.min(scale, 5)); // clamp

    updateTransform();
  });

  function updateTransform() {
    timeline.style.transform = `translate(calc(-50% + ${offsetX}px), calc(-50% + ${offsetY}px)) scale(${scale})`;
  }
</script>

</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Zoomable Timeline</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }
    #timeline-container {
      position: relative;
      width: 100%;
      height: 100px;
      border: 1px solid #333;
      overflow-x: scroll;
      white-space: nowrap;
      user-select: none;
    }
    #timeline {
      position: relative;
      height: 100px;
      left: 0;
    }
    .tick {
      position: absolute;
      bottom: 0;
      width: 1px;
      background-color: black;
    }
    .tick-year {
      position: absolute;
      bottom: 20px;
      font-size: 12px;
      white-space: nowrap;
      transform: translateX(-50%);
    }
    #controls {
      margin-bottom: 10px;
    }
    button {
      font-size: 16px;
      margin-right: 10px;
    }
  </style>
</head>
<body>

  <div id="controls">
    <button id="zoom-in">Zoom In +</button>
    <button id="zoom-out">Zoom Out -</button>
  </div>

  <div id="timeline-container">
    <div id="timeline"></div>
  </div>

  <!-- ðŸ”’ Hidden JSON config (edit start/endYear here!) -->
  <script id="timeline-config" type="application/json">
  {
    "startYear": 0,
    "endYear": 950
  }
  </script>

  <script>
    const configEl = document.getElementById('timeline-config');
    const config = configEl ? JSON.parse(configEl.textContent) : {};
    const startYear = config.startYear ?? 1000;
    const endYear = config.endYear ?? 2100;
    const totalYears = Math.max(endYear - startYear, 1); // prevent div-by-zero

    const timeline = document.getElementById('timeline');
    const timelineContainer = document.getElementById('timeline-container');
    const zoomInBtn = document.getElementById('zoom-in');
    const zoomOutBtn = document.getElementById('zoom-out');

    const maxPadding = 50;
    const basePixelsPerYear = 20;

    let zoomLevel = 1;
    let minZoom = 0.1;
    const maxZoom = 5;

    function calculateMinZoom(containerWidth) {
      return Math.max(0.01, (containerWidth - 2 * maxPadding) / (basePixelsPerYear * totalYears));
    }

    function getDynamicPadding(zoom) {
      const minPadding = 5;
      if (zoom >= 1) return maxPadding;
      const t = (zoom - minZoom) / (1 - minZoom);
      return minPadding + t * (maxPadding - minPadding);
    }

    function setInitialZoom() {
      const containerWidth = timelineContainer.clientWidth;
      minZoom = calculateMinZoom(containerWidth);
      zoomLevel = Math.max(minZoom, 1);
    }

    function renderTimeline() {
      timeline.innerHTML = '';

      const containerWidth = timelineContainer.clientWidth;
      minZoom = calculateMinZoom(containerWidth);
      if (zoomLevel < minZoom) zoomLevel = minZoom;

      const padding = getDynamicPadding(zoomLevel);
      const pixelsPerYear = basePixelsPerYear * zoomLevel;
      const timelineWidth = pixelsPerYear * totalYears + padding * 2;

      timeline.style.width = timelineWidth + 'px';
      timeline.style.height = '100px';

      let step;
      if (zoomLevel >= 2) {
        step = 1;
      } else if (zoomLevel >= 0.5) {
        step = 10;
      } else {
        step = 100;
      }

      for (let year = startYear; year <= endYear; year += step) {
        const x = padding + (year - startYear) * pixelsPerYear;

        const tick = document.createElement('div');
        tick.className = 'tick';
        tick.style.left = x + 'px';

        if (step === 1) tick.style.height = '30px';
        else if (step === 10) tick.style.height = '40px';
        else tick.style.height = '50px';

        timeline.appendChild(tick);

        const label = document.createElement('div');
        label.className = 'tick-year';
        label.style.left = x + 'px';
        label.textContent = year;
        timeline.appendChild(label);
      }

      if (timelineWidth < containerWidth) {
        timeline.style.left = ((containerWidth - timelineWidth) / 2) + 'px';
      } else {
        timeline.style.left = '0px';
      }
    }

    function zoom(factor, mouseX = null) {
      const containerWidth = timelineContainer.clientWidth;
      minZoom = calculateMinZoom(containerWidth);

      let newZoomLevel = zoomLevel * factor;
      newZoomLevel = Math.min(Math.max(newZoomLevel, minZoom), maxZoom);

      if (mouseX === null) {
        zoomLevel = newZoomLevel;
        renderTimeline();
        return;
      }

      const oldPadding = getDynamicPadding(zoomLevel);
      const newPadding = getDynamicPadding(newZoomLevel);
      const oldPixelsPerYear = basePixelsPerYear * zoomLevel;
      const newPixelsPerYear = basePixelsPerYear * newZoomLevel;

      const scrollLeft = timelineContainer.scrollLeft;
      const containerRect = timelineContainer.getBoundingClientRect();
      const mouseOffsetX = mouseX - containerRect.left;
      const timelineLeft = parseFloat(getComputedStyle(timeline).left) || 0;

      const yearAtMouse = startYear + (scrollLeft + mouseOffsetX - oldPadding - timelineLeft) / oldPixelsPerYear;
      const newScrollLeft = (yearAtMouse - startYear) * newPixelsPerYear + newPadding + timelineLeft - mouseOffsetX;

      zoomLevel = newZoomLevel;
      renderTimeline();

      const maxScroll = timeline.scrollWidth - timelineContainer.clientWidth;
      timelineContainer.scrollLeft = Math.min(Math.max(newScrollLeft, 0), maxScroll);
    }

    zoomInBtn.addEventListener('click', () => {
      const centerX = timelineContainer.getBoundingClientRect().left + timelineContainer.clientWidth / 2;
      zoom(1.5, centerX);
    });

    zoomOutBtn.addEventListener('click', () => {
      const centerX = timelineContainer.getBoundingClientRect().left + timelineContainer.clientWidth / 2;
      zoom(1 / 1.5, centerX);
    });

    timelineContainer.addEventListener('wheel', e => {
      e.preventDefault();
      const zoomFactor = e.deltaY < 0 ? 1.2 : 1 / 1.2;
      zoom(zoomFactor, e.clientX);
    });

    window.addEventListener('resize', renderTimeline);

    // ðŸš€ Initialize and render
    setInitialZoom();
    renderTimeline();
  </script>

</body>
</html>
